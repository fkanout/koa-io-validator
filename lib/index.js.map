{"version":3,"sources":["../src/index.js"],"names":["inputs","query","params","body","headers","config","undefined","Error","console","log","_config","denyUnknown","httpErrorCode","nextOnError","ctx","next","Joi","object","unknown","includes","validateAsync","request","headersLowered","Object","keys","reduce","destination","key","toLowerCase","status","error","state","routeValidationError","throw"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;;;eAEeA,MAAM,IAAI;AACvB,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,IAAjB;AAAuBC,IAAAA,OAAvB;AAAgCC,IAAAA;AAAhC,MAA2CL,MAAjD;;AACA,MAAIK,MAAM,KAAKC,SAAX,IAAwB,OAAOD,MAAP,KAAkB,QAA9C,EAAwD;AACtD,UAAM,IAAIE,KAAJ,CAAW,4CAA2C,OAAOF,MAAO,EAApE,CAAN;AACD;;AACDG,EAAAA,OAAO,CAACC,GAAR,CAAY,OAAOJ,MAAnB;;AAEA,QAAMK,OAAO;AACXC,IAAAA,WAAW,EAAE,EADF;AAEXC,IAAAA,aAAa,EAAE,GAFJ;AAGXC,IAAAA,WAAW,EAAE;AAHF,KAIRR,MAJQ,CAAb;;AAOA,SAAO,OAAOS,GAAP,EAAYC,IAAZ,KAAqB;AAC1B,QAAI;AACF,UAAId,KAAJ,EAAW;AACT,cAAMe,aAAIC,MAAJ,CAAWhB,KAAX,EACHiB,OADG,CACK,CAACR,OAAO,CAACC,WAAR,CAAoBQ,QAApB,CAA6B,OAA7B,CADN,EAEHC,aAFG,CAEWN,GAAG,CAACb,KAFf,CAAN;AAGD;;AACD,UAAIC,MAAJ,EAAY;AACV,cAAMc,aAAIC,MAAJ,CAAWf,MAAX,EAAmBkB,aAAnB,CAAiCN,GAAG,CAACZ,MAArC,CAAN;AACD;;AACD,UAAIC,IAAJ,EAAU;AACR,cAAMa,aAAIC,MAAJ,CAAWd,IAAX,EACHe,OADG,CACK,CAACR,OAAO,CAACC,WAAR,CAAoBQ,QAApB,CAA6B,MAA7B,CADN,EAEHC,aAFG,CAEWN,GAAG,CAACO,OAAJ,CAAYlB,IAFvB,CAAN;AAGD;;AACD,UAAIC,OAAJ,EAAa;AACX,cAAMkB,cAAc,GAAGC,MAAM,CAACC,IAAP,CAAYpB,OAAZ,EAAqBqB,MAArB,CAA4B,CAACC,WAAD,EAAcC,GAAd,KAAsB;AACvED,UAAAA,WAAW,CAACC,GAAG,CAACC,WAAJ,EAAD,CAAX,GAAiCxB,OAAO,CAACuB,GAAD,CAAxC;AACA,iBAAOD,WAAP;AACD,SAHsB,EAGpB,EAHoB,CAAvB;AAIA,cAAMV,aAAIC,MAAJ,CAAWK,cAAX,EACHJ,OADG,CACK,CAACR,OAAO,CAACC,WAAR,CAAoBQ,QAApB,CAA6B,SAA7B,CADN,EAEHC,aAFG,CAEWN,GAAG,CAACV,OAFf,CAAN;AAGD;;AACD,YAAMW,IAAI,EAAV,CAvBE,CAwBF;;AACA,UAAIf,MAAM,CAACc,GAAG,CAACe,MAAL,CAAV,EAAwB;AACtB,cAAMb,aAAIC,MAAJ,CAAWjB,MAAM,CAACc,GAAG,CAACe,MAAL,CAAjB,EAA+BT,aAA/B,CAA6CN,GAAG,CAACX,IAAjD,CAAN;AACD;AACF,KA5BD,CA4BE,OAAO2B,KAAP,EAAc;AACd,UAAIpB,OAAO,CAACG,WAAZ,EAAyB;AACvBC,QAAAA,GAAG,CAACiB,KAAJ,CAAUC,oBAAV,GAAiCF,KAAjC;AACD,OAFD,MAEO;AACLhB,QAAAA,GAAG,CAACmB,KAAJ,CAAUvB,OAAO,CAACE,aAAlB,EAAiCkB,KAAjC;AACD;AACF;AACF,GApCD;AAqCD,C","sourcesContent":["import Joi from \"@hapi/joi\";\nexport { Joi } from \"@hapi/joi\";\nexport default inputs => {\n  const { query, params, body, headers, config } = inputs;\n  if (config !== undefined && typeof config !== \"object\") {\n    throw new Error(`Route config, expecting object but found ${typeof config}`);\n  }\n  console.log(typeof config);\n\n  const _config = {\n    denyUnknown: [],\n    httpErrorCode: 400,\n    nextOnError: false,\n    ...config\n  };\n\n  return async (ctx, next) => {\n    try {\n      if (query) {\n        await Joi.object(query)\n          .unknown(!_config.denyUnknown.includes(\"query\"))\n          .validateAsync(ctx.query);\n      }\n      if (params) {\n        await Joi.object(params).validateAsync(ctx.params);\n      }\n      if (body) {\n        await Joi.object(body)\n          .unknown(!_config.denyUnknown.includes(\"body\"))\n          .validateAsync(ctx.request.body);\n      }\n      if (headers) {\n        const headersLowered = Object.keys(headers).reduce((destination, key) => {\n          destination[key.toLowerCase()] = headers[key];\n          return destination;\n        }, {});\n        await Joi.object(headersLowered)\n          .unknown(!_config.denyUnknown.includes(\"headers\"))\n          .validateAsync(ctx.headers);\n      }\n      await next();\n      // Output validator\n      if (inputs[ctx.status]) {\n        await Joi.object(inputs[ctx.status]).validateAsync(ctx.body);\n      }\n    } catch (error) {\n      if (_config.nextOnError) {\n        ctx.state.routeValidationError = error;\n      } else {\n        ctx.throw(_config.httpErrorCode, error);\n      }\n    }\n  };\n};\n"],"file":"index.js"}