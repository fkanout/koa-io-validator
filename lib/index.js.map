{"version":3,"sources":["../src/index.js"],"names":["inputs","query","params","body","headers","config","undefined","Object","prototype","toString","call","message","_config","denyUnknown","httpErrorCode","nextOnError","ctx","next","Joi","object","unknown","includes","validateAsync","request","headersLowered","keys","reduce","destination","key","toLowerCase","status","error","state","routeValidationError","throw"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;;;eAEeA,MAAM,IAAI;AACvB,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBC,IAAAA,IAAjB;AAAuBC,IAAAA,OAAvB;AAAgCC,IAAAA;AAAhC,MAA2CL,MAAjD;;AAEA,MAAIK,MAAM,KAAKC,SAAX,IAAwBC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BL,MAA/B,MAA2C,iBAAvE,EAA0F;AACxF,UAAO;AAAEM,MAAAA,OAAO,EAAG;AAAZ,KAAP;AACD;;AAED,QAAMC,OAAO;AACXC,IAAAA,WAAW,EAAE,EADF;AAEXC,IAAAA,aAAa,EAAE,GAFJ;AAGXC,IAAAA,WAAW,EAAE;AAHF,KAIRV,MAJQ,CAAb;;AAOA,SAAO,OAAOW,GAAP,EAAYC,IAAZ,KAAqB;AAC1B,QAAI;AACF,UAAIhB,KAAJ,EAAW;AACT,cAAMiB,aAAIC,MAAJ,CAAWlB,KAAX,EACHmB,OADG,CACK,CAACR,OAAO,CAACC,WAAR,CAAoBQ,QAApB,CAA6B,OAA7B,CADN,EAEHC,aAFG,CAEWN,GAAG,CAACf,KAFf,CAAN;AAGD;;AACD,UAAIC,MAAJ,EAAY;AACV,cAAMgB,aAAIC,MAAJ,CAAWjB,MAAX,EAAmBoB,aAAnB,CAAiCN,GAAG,CAACd,MAArC,CAAN;AACD;;AACD,UAAIC,IAAJ,EAAU;AACR,cAAMe,aAAIC,MAAJ,CAAWhB,IAAX,EACHiB,OADG,CACK,CAACR,OAAO,CAACC,WAAR,CAAoBQ,QAApB,CAA6B,MAA7B,CADN,EAEHC,aAFG,CAEWN,GAAG,CAACO,OAAJ,CAAYpB,IAFvB,CAAN;AAGD;;AACD,UAAIC,OAAJ,EAAa;AACX,cAAMoB,cAAc,GAAGjB,MAAM,CAACkB,IAAP,CAAYrB,OAAZ,EAAqBsB,MAArB,CAA4B,CAACC,WAAD,EAAcC,GAAd,KAAsB;AACvED,UAAAA,WAAW,CAACC,GAAG,CAACC,WAAJ,EAAD,CAAX,GAAiCzB,OAAO,CAACwB,GAAD,CAAxC;AACA,iBAAOD,WAAP;AACD,SAHsB,EAGpB,EAHoB,CAAvB;AAIA,cAAMT,aAAIC,MAAJ,CAAWK,cAAX,EACHJ,OADG,CACK,CAACR,OAAO,CAACC,WAAR,CAAoBQ,QAApB,CAA6B,SAA7B,CADN,EAEHC,aAFG,CAEWN,GAAG,CAACZ,OAFf,CAAN;AAGD;;AACD,YAAMa,IAAI,EAAV,CAvBE,CAwBF;;AACA,UAAIjB,MAAM,CAACgB,GAAG,CAACc,MAAL,CAAV,EAAwB;AACtB,cAAMZ,aAAIC,MAAJ,CAAWnB,MAAM,CAACgB,GAAG,CAACc,MAAL,CAAjB,EAA+BR,aAA/B,CAA6CN,GAAG,CAACb,IAAjD,CAAN;AACD;AACF,KA5BD,CA4BE,OAAO4B,KAAP,EAAc;AACd,UAAInB,OAAO,CAACG,WAAZ,EAAyB;AACvBC,QAAAA,GAAG,CAACgB,KAAJ,CAAUC,oBAAV,GAAiCF,KAAjC;AACD,OAFD,MAEO;AACLf,QAAAA,GAAG,CAACkB,KAAJ,CAAUtB,OAAO,CAACE,aAAlB,EAAiCiB,KAAjC;AACD;AACF;AACF,GApCD;AAqCD,C","sourcesContent":["import Joi from \"@hapi/joi\";\nexport { Joi } from \"@hapi/joi\";\nexport default inputs => {\n  const { query, params, body, headers, config } = inputs;\n\n  if (config !== undefined && Object.prototype.toString.call(config) !== \"[object Object]\") {\n    throw ({ message: `Route config, expecting config to be an Object` });\n  }\n\n  const _config = {\n    denyUnknown: [],\n    httpErrorCode: 400,\n    nextOnError: false,\n    ...config\n  };\n\n  return async (ctx, next) => {\n    try {\n      if (query) {\n        await Joi.object(query)\n          .unknown(!_config.denyUnknown.includes(\"query\"))\n          .validateAsync(ctx.query);\n      }\n      if (params) {\n        await Joi.object(params).validateAsync(ctx.params);\n      }\n      if (body) {\n        await Joi.object(body)\n          .unknown(!_config.denyUnknown.includes(\"body\"))\n          .validateAsync(ctx.request.body);\n      }\n      if (headers) {\n        const headersLowered = Object.keys(headers).reduce((destination, key) => {\n          destination[key.toLowerCase()] = headers[key];\n          return destination;\n        }, {});\n        await Joi.object(headersLowered)\n          .unknown(!_config.denyUnknown.includes(\"headers\"))\n          .validateAsync(ctx.headers);\n      }\n      await next();\n      // Output validator\n      if (inputs[ctx.status]) {\n        await Joi.object(inputs[ctx.status]).validateAsync(ctx.body);\n      }\n    } catch (error) {\n      if (_config.nextOnError) {\n        ctx.state.routeValidationError = error;\n      } else {\n        ctx.throw(_config.httpErrorCode, error);\n      }\n    }\n  };\n};\n"],"file":"index.js"}